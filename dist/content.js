(()=>{"use strict";class ContentScript{constructor(){this.privacyPolicyUrls=[],console.log("üîç Kavach Content Script starting on:",window.location.href),this.detectPrivacyPolicies(),this.injectTrackingDetector(),console.log("‚úÖ Kavach Content Script initialized")}detectPrivacyPolicies(){const t=["privacy policy","privacy statement","privacy notice","terms of service","terms and conditions","data policy","cookie policy","legal","gdpr","ccpa"];['a[href*="privacy"]','a[href*="terms"]','a[href*="policy"]','a[href*="legal"]','a[href*="gdpr"]','a[href*="ccpa"]'].forEach((e=>{document.querySelectorAll(e).forEach((e=>{const n=e.href,o=e.textContent?.toLowerCase()||"";n&&!this.privacyPolicyUrls.includes(n)&&t.some((t=>o.includes(t)||n.toLowerCase().includes(t)))&&this.privacyPolicyUrls.push(n)}))})),document.querySelectorAll('footer, .footer, [class*="footer"]').forEach((e=>{e.querySelectorAll("a").forEach((e=>{const n=e.href,o=e.textContent?.toLowerCase()||"";n&&!this.privacyPolicyUrls.includes(n)&&t.some((t=>o.includes(t)))&&this.privacyPolicyUrls.push(n)}))})),this.privacyPolicyUrls.length>0&&chrome.runtime.sendMessage({action:"privacyPoliciesFound",urls:this.privacyPolicyUrls,currentUrl:window.location.href}).catch((t=>{console.log("Failed to send privacy policy URLs:",t)}))}injectTrackingDetector(){const t=document.createElement("script");t.src=chrome.runtime.getURL("injected.js"),t.onload=function(){this.remove()},(document.head||document.documentElement).appendChild(t)}createGDPROptOutButton(){const t=document.createElement("div");t.id="kavach-gdpr-button",t.innerHTML='\n      <div style="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        z-index: 10000;\n        background: #2563eb;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 8px;\n        font-family: system-ui, -apple-system, sans-serif;\n        font-size: 14px;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        transition: all 0.2s ease;\n      " onmouseover="this.style.backgroundColor=\'#1d4ed8\'" \n         onmouseout="this.style.backgroundColor=\'#2563eb\'">\n        üõ°Ô∏è Quick Privacy Opt-out\n      </div>\n    ',t.addEventListener("click",(()=>{this.showOptOutDialog()})),document.body.appendChild(t)}showOptOutDialog(){const t=document.createElement("div");t.innerHTML='\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0,0,0,0.5);\n        z-index: 10001;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      ">\n        <div style="\n          background: white;\n          padding: 24px;\n          border-radius: 12px;\n          max-width: 400px;\n          margin: 20px;\n          box-shadow: 0 10px 25px rgba(0,0,0,0.2);\n        ">\n          <h3 style="margin: 0 0 16px 0; color: #1f2937;">Privacy Rights</h3>\n          <p style="margin: 0 0 20px 0; color: #6b7280; line-height: 1.5;">\n            Exercise your privacy rights under GDPR/CCPA. This will help you opt-out of data collection and tracking.\n          </p>\n          <div style="display: flex; gap: 12px; justify-content: flex-end;">\n            <button id="kavach-cancel" style="\n              padding: 8px 16px;\n              border: 1px solid #d1d5db;\n              background: white;\n              color: #374151;\n              border-radius: 6px;\n              cursor: pointer;\n            ">Cancel</button>\n            <button id="kavach-optout" style="\n              padding: 8px 16px;\n              border: none;\n              background: #dc2626;\n              color: white;\n              border-radius: 6px;\n              cursor: pointer;\n            ">Opt Out</button>\n          </div>\n        </div>\n      </div>\n    ',document.body.appendChild(t),t.querySelector("#kavach-cancel")?.addEventListener("click",(()=>{t.remove()})),t.querySelector("#kavach-optout")?.addEventListener("click",(()=>{this.performOptOut(),t.remove()}))}performOptOut(){const optOutActions=['document.cookie = "gdpr_consent=false; path=/; max-age=31536000"','document.cookie = "ccpa_optout=true; path=/; max-age=31536000"','localStorage.setItem("privacy_optout", "true")'];optOutActions.forEach((action=>{try{eval(action)}catch(t){console.log("Opt-out action failed:",action)}}));const notification=document.createElement("div");notification.innerHTML='\n      <div style="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 10002;\n        background: #10b981;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 8px;\n        font-family: system-ui, -apple-system, sans-serif;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      ">\n        ‚úÖ Privacy opt-out completed\n      </div>\n    ',document.body.appendChild(notification),setTimeout((()=>notification.remove()),3e3)}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{this.createGDPROptOutButton(),this.detectPrivacyPolicies()}),1e3)})):setTimeout((()=>{this.createGDPROptOutButton(),this.detectPrivacyPolicies()}),1e3),setTimeout((()=>{this.detectPrivacyPolicies()}),3e3)}}const contentScript=new ContentScript;contentScript.init()})();